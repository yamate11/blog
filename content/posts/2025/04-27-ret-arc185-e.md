---
author: "yamate11"
title: "ARC185E - Adjacent GCD"
date: "2025-04-27T13:50:34+09:00"
# date_init: "2025-04-27"
tags: ["GCD", "ゼータ変換", "オイラーのφ関数"]
categories: ["retrospective"]
# categories: ["solution"]
# summary: "要約を書いておく．ここには問題タイトル等は不要" 
---

## 問題概要

[問題へのリンク](https://atcoder.jp/contests/arc185/tasks/arc185_e)

整数 $N$ と，長さ $N$ の正の整数列 $(A_1, \ldots, A_N)$ が与えられる．
$m = 1, 2, \ldots, N$ に対して，次の問題を解け

* 列 $(A_1, \dots, A_m)$ の空でない部分列のスコアの総和を 998244353 で割ったあまりを求めよ．
  ただし，列 $(B_1, \ldots, B_k)$ のスコアは，$\displaystyle\sum_{i = 1}^{k-1} \textrm{gcd}(B_i, B_{i + 1})$ である．


#### 制約

$1\leq N \leq 5\times10^{5}$，$1 \leq A_i \leq 10^5$


## 解

* [公式解説へのリンク](https://atcoder.jp/contests/arc185/editorial/11129)
* [ユーザ解説 (noshi91) へのリンク](https://atcoder.jp/contests/arc185/editorial/11160)

すこし考察すると，解を $R_1, \ldots, R_N$ として，

$$ R_i = 2R_{i - 1} + \sum_{j = 1}^{i - 1} 2^j \textrm{gcd}(A_i, A_j) $$

であることがわかる．
だから，$\sum_{j = 1}^{i - 1} 2^j \textrm{gcd}(A_i, A_j)$ が高速に求められれば良い．
以下，これを記述する．

<div>
<details open>
<summary>解1 (公式解説)．click to open</summary>

整数 $x$ の約数の集合を $D(x)$ と書くことにする．$x \leq 5\times10^5$ のとき，$|D(x)| \leq 128$ である．

オイラーの $\varphi$関数 ($\varphi(x)$ は，$x$ と互いに素である $x$ 以下の整数の個数) を使う．
$n = \sum_{d \in D(n)} \varphi(d)$ が成り立つのであった．

\begin{align*}
\sum_j 2^j \text{gcd}(A_i, A_j) 
& =\sum_j 2^j \sum \\{ \varphi(d) \mid d \in D(\text{gcd}(A_i, A_j)) \\} \\\\
& =\sum_j 2^j \sum \\{ \varphi(d) \mid d \in D(A_i), d \in D(A_j) \\} \\\\
& =\sum_{d \in D(A_i)} \varphi(d) \sum_j ( \texttt{if } d|A_j \texttt{ then } 2^j \texttt{ else } 0)
\end{align*}

$\sum_j ( \texttt{if } d|A_j \texttt{ then } 2^j \texttt{ else } 0)$ の部分は，各 $d$ に対する値を
全部持っていて，$i$ が 1増えるたびに更新すれば良い．更新箇所は $|D(A_i)|$ 箇所である．

</details>
</div>
        
<div>

<details open>
<summary>解2 (noshi91 のユーザ解説)．click to open</summary>

GCD畳み込みを用いる．
$h(n) = \sum \\{ f(i)g(j) \mid \text{gcd}(i, j) = n \\}$，
$F(n) = \sum_{n|i} f(i)$，
$G(n) = \sum_{n|i} g(i)$，
$H(n) = \sum_{n|i} h(i)$
であるとき，$H(n) = F(n)G(n)$
が成り立つのであった．




def

</details>
</div>

おそらく，解1と解2は同じ原理に依っているのだろうと思うが，まだ整理できていない．





